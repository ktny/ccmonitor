# ccstat (Go Edition)

[![Go CI](https://github.com/ktny/ccstat/actions/workflows/go-ci.yml/badge.svg)](https://github.com/ktny/ccstat/actions/workflows/go-ci.yml)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

A high-performance CLI tool that analyzes Claude Code session history and visualizes project activity patterns in a timeline format.

**This is the Go implementation of ccstat**, offering:

- **High Performance**: Fast processing of large log files
- **Low Memory Usage**: Efficient memory management
- **Single Binary**: No dependencies, easy deployment
- **Cross-Platform**: Windows, macOS, Linux support

> üìù **Note**: For the main TypeScript version, see [README.md](../README.md).

## ‚ú® Features

- üìä **Timeline Visualization**: Visual timeline showing project activity patterns
- üîç **Smart Analysis**: Automatically calculates active time based on message intervals (3-minute threshold)
- üóÇÔ∏è **Git Integration**: Automatically groups projects by Git repository
- üå≥ **Worktree Support**: Handles Git worktrees and shows parent-child relationships
- üé® **Beautiful UI**: Terminal-based UI with color-coded activity density
- ‚ö° **Fast Performance**: Optimized for handling large log files
- üîß **Flexible Options**: Multiple time range options and display modes

## üöÄ Installation

### Pre-built Binaries

Download pre-built binaries from the [releases page](https://github.com/ktny/ccstat/releases).

### Build from Source

```bash
# Clone the repository
git clone https://github.com/ktny/ccstat.git
cd ccstat/go

# Build the binary
make build

# Or build manually
go build -o bin/ccstat ./cmd/ccstat

# Install to $GOPATH/bin
make install
```

## üìñ Usage

### Basic Usage

```bash
# Show activity for the last 1 day (default)
./bin/ccstat

# Show activity for the last 7 days
./bin/ccstat --days 7

# Show activity for the last 6 hours
./bin/ccstat --hours 6
# or using short option
./bin/ccstat -H 6
```

### Advanced Options

```bash
# Worktree display (separate directories within the same repository)
./bin/ccstat --worktree

# Enable debug output
./bin/ccstat --debug

# Show version information
./bin/ccstat --version

# Show help
./bin/ccstat --help
```

### Development Commands

```bash
# Code formatting (ALWAYS run before committing)
go fmt ./...

# Code linting
golangci-lint run

# Build and test
make build
make test

# Run ccstat in development environment
make run
make run-days   # --days 2
make run-hours  # --hours 6

# Clean build artifacts
make clean
```

## üèóÔ∏è Architecture

### Tech Stack

- **Language**: Go 1.23+
- **CLI Framework**: Cobra
- **Terminal UI**: Lipgloss
- **Git Integration**: Native Git config parsing
- **Concurrency**: Goroutines for parallel file processing

### Project Structure

```
go/
‚îú‚îÄ‚îÄ cmd/ccstat/           # Main application entry point
‚îÇ   ‚îú‚îÄ‚îÄ main.go          # CLI interface & main execution logic
‚îÇ   ‚îî‚îÄ‚îÄ main_test.go     # Basic integration tests
‚îú‚îÄ‚îÄ internal/            # Internal packages
‚îÇ   ‚îú‚îÄ‚îÄ claude/         # Claude log parsing & session analysis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser.go   # Core JSONL parsing & session grouping
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ parser_test.go
‚îÇ   ‚îú‚îÄ‚îÄ git/            # Git repository utilities
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.go    # Git config parsing & repo name extraction
‚îÇ   ‚îî‚îÄ‚îÄ ui/             # User interface & visualization
‚îÇ       ‚îî‚îÄ‚îÄ table.go    # Terminal UI using lipgloss
‚îú‚îÄ‚îÄ pkg/models/         # Shared data models
‚îÇ   ‚îî‚îÄ‚îÄ events.go       # SessionEvent & SessionTimeline structs
‚îú‚îÄ‚îÄ go.mod              # Go module definition
‚îú‚îÄ‚îÄ go.sum              # Go module checksums
‚îú‚îÄ‚îÄ Makefile           # Build automation
‚îî‚îÄ‚îÄ README.md          # This file
```

## üìä Output Example

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                                                                                    ‚îÇ
‚îÇ  üìä Claude Project Timeline | 2025-07-03 16:49 - 2025-07-03 22:49 (6 hours) | 3 projects                                        ‚îÇ
‚îÇ                                                                                                                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                                                                                                                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Project             Timeline | less ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ† more      Events  Duration                                                         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                                                                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                      17  18   19  20   21   22                                                                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ccstat              ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†        1011       51m                                                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  web-project         ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†                   245        23m                                                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ mobile-app       ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†                            67         12m                                                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                                                                                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                                                                                    ‚îÇ
‚îÇ  Summary Statistics:                                                                                                               ‚îÇ
‚îÇ    - Total Projects: 3                                                                                                            ‚îÇ
‚îÇ    - Total Events: 1323                                                                                                           ‚îÇ
‚îÇ    - Total Duration: 86 minutes                                                                                                   ‚îÇ
‚îÇ                                                                                                                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ Key Algorithms

### Active Duration Calculation

- Only counts time between consecutive events ‚â§ 3 minutes as active
- Excludes long breaks (> 3 minutes) to measure actual work time
- Minimum 5 minutes for single events
- Provides realistic work time estimates

### Project Grouping Logic

- **Default Mode**: Consolidates all directories within same Git repo
- **Worktree Mode**: Shows parent-child relationships for complex repos
- **Repository Detection**: Uses Git config parsing with fallback to directory names

### Timeline Visualization

- Maps event count to 5-level color scale for activity density
- Automatically selects appropriate time intervals based on range
- Character-based timeline bars using `‚ñ†` symbols with color coding

## üîß Configuration

### Data Sources

ccstat reads Claude Code session logs from:

- `~/.claude/projects/*/*.jsonl` (primary)

### File Format

Each line in the JSONL files represents a session event:

```json
{
  "timestamp": "2025-07-03T12:34:56.789Z",
  "sessionId": "session-123",
  "cwd": "/home/user/project",
  "message": "user message",
  "usage": { "input_tokens": 100, "output_tokens": 50 }
}
```

## üõ†Ô∏è Development

### Prerequisites

- Go 1.23 or higher
- Make (optional, for convenience)
- golangci-lint (optional, for linting)

### Setup

```bash
# Clone the repository
git clone https://github.com/ktny/ccstat.git
cd ccstat/go

# Install dependencies
go mod download

# Build the project
make build

# Run tests
make test
```

### Available Make Commands

```bash
make build        # Build the binary
make install      # Install to $GOPATH/bin
make test         # Run tests
make run          # Build and run with defaults
make run-days     # Build and run with --days 2
make run-hours    # Build and run with --hours 6
make clean        # Clean build artifacts
```

### Code Quality

- **MANDATORY**: Always run `go fmt ./...` before committing
- **MANDATORY**: Run `golangci-lint run` and fix all issues before committing
- Follow Go standard conventions for naming and structure
- Add comments for exported functions and types
- Use meaningful variable names

## üì¶ Build & Release

### Building for Production

```bash
# Build for current platform
make build

# Build for multiple platforms
GOOS=linux GOARCH=amd64 go build -o bin/ccstat-linux-amd64 ./cmd/ccstat
GOOS=windows GOARCH=amd64 go build -o bin/ccstat-windows-amd64.exe ./cmd/ccstat
GOOS=darwin GOARCH=amd64 go build -o bin/ccstat-darwin-amd64 ./cmd/ccstat
```

## üöÄ Performance

The Go version is optimized for:

- **Large log files**: Efficient streaming processing
- **Memory usage**: Minimal memory footprint
- **Startup time**: Fast cold starts
- **Concurrency**: Parallel file processing

### Benchmarks

Typical performance on a modern machine:

- **1MB log file**: ~10ms processing time
- **100MB log files**: ~1s processing time
- **Memory usage**: ~50MB peak for 100MB input

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feat/amazing-feature`)
3. Make your changes
4. Run quality checks (`go fmt ./...` and `golangci-lint run`)
5. Run tests (`make test`)
6. Commit your changes (`git commit -m 'Add amazing feature'`)
7. Push to the branch (`git push origin feat/amazing-feature`)
8. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](../LICENSE) file for details.

## üôè Acknowledgments

- Built with [Cobra](https://github.com/spf13/cobra) for CLI framework
- Styled with [Lipgloss](https://github.com/charmbracelet/lipgloss) for beautiful terminal output
- Original TypeScript implementation provided the foundation
- Thanks to the Claude Code team for the session logging format

## üìû Support

- üêõ [Report Bug](https://github.com/ktny/ccstat/issues)
- üí° [Request Feature](https://github.com/ktny/ccstat/issues)
- üìß [Contact](https://github.com/ktny)

---

Made with ‚ù§Ô∏è by [ktny](https://github.com/ktny)
